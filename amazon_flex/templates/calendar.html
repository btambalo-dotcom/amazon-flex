{% extends 'base.html' %}{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="mb-0">Calendário</h1>
  <div class="d-flex gap-2">
    <a class="btn btn-primary" href="{{ url_for('scheduled_new') }}">Agendar Corrida</a>
  </div>
</div>
<div class="row g-3">
  <div class="col-lg-8">
    <div class="card p-3"><div id="calendar"></div></div>
  </div>
  <div class="col-lg-4">
    <div class="card p-3">
      <h5>Próximas corridas</h5>
      <ul class="list-group list-group-flush">
        {% for r in rides %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <div>
            <div class="fw-semibold">{{ r.title }}</div>
            <div class="small text-muted">{{ r.start_dt.strftime("%d/%m/%Y %H:%M") }}</div>
          </div>
          <div class="d-flex gap-2">
            <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('scheduled_edit', ride_id=r.id) }}">Editar</a>
            <form method="post" action="{{ url_for('scheduled_delete', ride_id=r.id) }}" onsubmit="return confirm('Excluir este agendamento?')">
              <button class="btn btn-sm btn-outline-danger">Excluir</button>
            </form>
          </div>
        </li>
        {% else %}
        <li class="list-group-item">Sem itens recentes.</li>
        {% endfor %}
      </ul>
    </div>
  </div>
</div>

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/locales-all.global.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  var calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
    initialView: 'dayGridMonth',
    height: 'auto',
    locale: 'pt-br',
    headerToolbar: { left: 'prev,next today', center: 'title', right: 'dayGridMonth,timeGridWeek,timeGridDay' },
    events: '{{ url_for("api_scheduled") }}',
    eventTimeFormat: { hour: '2-digit', minute: '2-digit', meridiem: false }
  });
  calendar.render();
});
</script>
{% endblock %}
